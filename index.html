<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stargazer Editor - Workspace</title>
    <style>
        :root { --primary: #007AFF; --glass: rgba(255, 255, 255, 0.05); }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background: #000; color: white; height: 100vh; overflow: hidden;
            font-family: -apple-system, system-ui, sans-serif;
            display: flex; flex-direction: column;
        }

        /* Estrelas de fundo tamb√©m no editor para manter a identidade */
        .stars-bg { position: fixed; width: 100%; height: 100%; z-index: -1; }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.3; animation: fall linear infinite; }
        @keyframes fall { from { transform: translateY(-10vh); } to { transform: translateY(110vh); } }

        /* Header com Slider de Resolu√ß√£o */
        .header { 
            padding: 20px; display: flex; align-items: center; justify-content: space-between;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
        }

        .res-container { flex: 1; margin: 0 30px; position: relative; }
        .res-track { 
            height: 4px; background: #333; border-radius: 10px; position: relative; 
            display: flex; justify-content: space-between; align-items: center;
        }
        .res-node { 
            width: 12px; height: 12px; background: #555; border-radius: 50%; 
            transition: 0.3s; cursor: pointer; position: relative;
        }
        .res-node.active { background: var(--primary); box-shadow: 0 0 10px var(--primary); }
        .res-node span { 
            position: absolute; top: 18px; left: 50%; transform: translateX(-50%);
            font-size: 9px; color: #888; white-space: nowrap;
        }
        .res-node.active span { color: var(--primary); font-weight: bold; }

        /* √Årea do Canvas */
        .viewport { flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px; }
        canvas { 
            max-width: 100%; max-height: 100%; border-radius: 12px;
            box-shadow: 0 0 50px rgba(0, 122, 255, 0.1); background: #050505; 
        }

        /* Toolbar e Gaveta de Efeitos */
        .bottom-nav { background: var(--glass); backdrop-filter: blur(20px); border-top: 1px solid rgba(255,255,255,0.1); padding: 15px; }
        .tool-grid { display: flex; justify-content: space-around; }
        .tool-item { display: flex; flex-direction: column; align-items: center; gap: 5px; font-size: 11px; opacity: 0.7; }
        
        .drawer {
            position: fixed; bottom: -350px; left: 0; width: 100%; height: 320px;
            background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(25px);
            border-top: 1px solid rgba(255,255,255,0.1); border-radius: 25px 25px 0 0;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 100; padding: 20px;
        }
        .drawer.open { bottom: 0; }
        .drawer-header { display: flex; justify-content: space-between; margin-bottom: 20px; color: var(--primary); font-weight: bold; }

        .effects-list { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 15px; }
        .fx-card { 
            min-width: 90px; height: 110px; background: var(--glass); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        
        #exportBtn { background: var(--primary); border: none; color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold; font-size: 12px; }
    </style>
</head>
<body>

    <div class="stars-bg" id="stars"></div>

    <div class="header">
        <span onclick="window.location.href='index.html'">‚úï</span>
        
        <div class="res-container">
            <div class="res-track">
                <div class="res-node active" onclick="setRes(0, this)"><span>480P</span></div>
                <div class="res-node" onclick="setRes(1, this)"><span>720P</span></div>
                <div class="res-node" onclick="setRes(2, this)"><span>1080P</span></div>
            </div>
        </div>

        <button id="exportBtn">SALVAR</button>
    </div>

    <div class="viewport">
        <canvas id="mainCanvas"></canvas>
    </div>

    <div class="drawer" id="fxDrawer">
        <div class="drawer-header">
            <span>EFEITOS DE PASTA</span>
            <span onclick="toggleDrawer()">PRONTO</span>
        </div>
        <div class="effects-list">
            <div class="fx-card" onclick="applyEffect('invert')"><span>üåì</span><br>Inverter</div>
            <div class="fx-card" onclick="applyEffect('grayscale')"><span>üîò</span><br>P&B</div>
            <div class="fx-card" onclick="applyEffect('sepia')"><span>üìú</span><br>S√©pia</div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="tool-grid">
            <div class="tool-item" onclick="toggleDrawer()">
                <span style="font-size: 24px;">‚ú®</span>
                <span>Efeitos</span>
            </div>
            <div class="tool-item">
                <span style="font-size: 24px;">üé®</span>
                <span>Ajustes</span>
            </div>
        </div>
    </div>

    <script>
        // Mesmo gerador de estrelas do index para manter o visual
        const starContainer = document.getElementById('stars');
        for (let i = 0; i < 30; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            const size = Math.random() * 2 + 'px';
            star.style.width = size; star.style.height = size;
            star.style.left = Math.random() * 100 + '%';
            star.style.animationDuration = (Math.random() * 3 + 2) + 's';
            starContainer.appendChild(star);
        }

        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const resolutions = [
            { w: 854, h: 480 }, { w: 1280, h: 720 }, { w: 1920, h: 1080 }
        ];
        let currentRes = 0;
        let originalImg = new Image();

        // Carregar a imagem enviada pelo Index
        const savedImg = sessionStorage.getItem('temp_image');
        if (savedImg) {
            originalImg.src = savedImg;
            originalImg.onload = () => updateCanvas();
        }

        function setRes(index, el) {
            document.querySelectorAll('.res-node').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            currentRes = index;
            updateCanvas();
        }

        function updateCanvas() {
            const res = resolutions[currentRes];
            canvas.width = res.w;
            canvas.height = res.h;
            
            // Desenha a imagem centralizada (Fit)
            const ratio = Math.min(canvas.width / originalImg.width, canvas.height / originalImg.height);
            const nw = originalImg.width * ratio;
            const nh = originalImg.height * ratio;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(originalImg, (canvas.width - nw) / 2, (canvas.height - nh) / 2, nw, nh);
        }

        function toggleDrawer() { document.getElementById('fxDrawer').classList.toggle('open'); }

        // Fun√ß√£o de Exportar Corrigida
        document.getElementById('exportBtn').onclick = () => {
            const link = document.createElement('a');
            link.download = `stargazer_export_${resolutions[currentRes].w}p.png`;
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
        };

        function applyEffect(type) {
            const imgData = ctx.getImageData(0,0, canvas.width, canvas.height);
            const d = imgData.data;
            for (let i = 0; i < d.length; i += 4) {
                if(type === 'invert') { d[i]=255-d[i]; d[i+1]=255-d[i+1]; d[i+2]=255-d[i+2]; }
                if(type === 'grayscale') { let v = (d[i]+d[i+1]+d[i+2])/3; d[i]=d[i+1]=d[i+2]=v; }
            }
            ctx.putImageData(imgData, 0, 0);
        }
    </script>
</body>
</html>
